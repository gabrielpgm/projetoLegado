<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Cliente</title>
    <script>
        function formatarCpf(event) {
            const input = event.target;
            let value = input.value.replace(/\D/g, ''); // Remove caracteres não numéricos
            if (value.length > 11) value = value.slice(0, 11); // Limita a 11 dígitos
            const formattedCpf = value.replace(/(\d{3})(\d)/, '$1.$2') // Adiciona o primeiro ponto
                                       .replace(/(\d{3})(\d)/, '$1.$2') // Adiciona o segundo ponto
                                       .replace(/(\d{3})(\d{1,2})$/, '$1-$2'); // Adiciona o hífen
            input.value = formattedCpf; // Atualiza o valor do input
        }

        function cpfInvalido() {
            alert("CPF inválido. Por favor, insira um CPF válido.");
        }

        function cpfDuplicado() {
            alert("CPF já cadastrado. Por favor, insira um CPF diferente.");
        }
    </script>
</head>
<body>
    <h1>{{ 'Editar Cliente' if modo == 'editar' else 'Cadastro de Cliente' }}</h1>

    <form action="{% if cliente %}{{ url_for('editar_cliente', numero_identificador=cliente.numero_identificador) }}{% else %}{{ url_for('cadastro_cliente') }}{% endif %}" method="POST" enctype="multipart/form-data">
        <label for="numero_identificador">Número Identificador:</label>
        <input type="text" id="numero_identificador" name="numero_identificador" value="{{ cliente.numero_identificador if cliente else '' }}" disabled><br><br>
    
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" value="{{ cliente.nome }}" required><br><br>
    
        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" value="{{ cliente.cpf if cliente else '' }}" required oninput="formatarCpf(event)"><br><br>
    
        <label for="identidade">Identidade:</label>
        <input type="file" id="identidade" name="identidade"><br><br>
        <label for="comentario_identidade">Comentário (Identidade):</label>
        <input type="text" id="comentario_identidade" name="comentario_identidade" value="{{ cliente.documentos.identidade.comentario if cliente and cliente.documentos and cliente.documentos.identidade else '' }}"><br><br>

        <label for="cnh">CNH:</label>
        <input type="file" id="cnh" name="cnh"><br><br>
        <label for="comentario_cnh">Comentário (CNH):</label>
        <input type="text" id="comentario_cnh" name="comentario_cnh" value="{{ cliente.documentos.cnh.comentario if cliente and cliente.documentos and cliente.documentos.cnh else '' }}"><br><br>
    
        <label for="comprovante_endereco">Comprovante de Endereço:</label>
        <input type="file" id="comprovante_endereco" name="comprovante_endereco"><br><br>
        <label for="comentario_comprovante">Comentário (Comprovante de Endereço):</label>
        <input type="text" id="comentario_comprovante" name="comentario_comprovante" value="{{ cliente.documentos.comprovante_endereco.comentario if cliente and cliente.documentos and cliente.documentos.comprovante_endereco else '' }}"><br><br>
    
        <label for="outros">Outros Documentos:</label>
        <input type="file" id="outros" name="outros"><br><br>
        <label for="comentario_outros">Comentário (Outros Documentos):</label>
        <input type="text" id="comentario_outros" name="comentario_outros" value="{{ cliente.documentos.outros.comentario if cliente and cliente.documentos and cliente.documentos.outros else '' }}"><br><br>
    
        <button type="submit">Salvar</button>
    </form>    

    <!-- Botão para voltar ao dashboard -->
    <form action="/dashboard" method="GET">
        <button type="submit">Voltar para o Dashboard</button>
    </form>

    {% if cpf_invalido %}
    <script>
        cpfInvalido();
    </script>
    {% endif %}

    {% if cpf_duplicado %}
    <script>
        cpfDuplicado();
    </script>
    {% endif %}
</body>
</html>
